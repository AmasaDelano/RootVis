
<div class="row items-row">
  <div class="col">
    <div class="items" *ngIf="state && state.craftedItems">
      <img class="item"
           *ngFor="let item of rootlogService.allItems"
           [class.crafted]="(state.craftedItems[item.item] || 0) > item.craftedIf"
           [src]="'assets/icon/item-' + item.item + '.png'" />
    </div>
  </div>
</div>

<div class="row">
  <div class="col clearing-col">
    <mat-card class="clearing-info-container" *ngIf="game && clearing && state && game.clearings">
      <mat-card-header>
        <mat-card-title>Clearing #{{ currentClearing }}</mat-card-title>

        <img class="clearing-suit" [src]="'assets/clearing/clearing-' + rootlogService.getSuitName(game.clearings[currentClearing - 1]) + '.png'" *ngIf="currentClearing > 0" />
      </mat-card-header>

      <mat-card-content>
        <div>
          <div class="clearing-warriors" *ngIf="clearingHasWarriors(clearing)">
            <h3>Warriors</h3>

            <div class="clearing-warrior-container-container">
              <div class="clearing-warrior-container" *ngFor="let warCount of clearing.warriors | keyvalue" [class.hidden]="!warCount.value">
                <img class="clearing-component warrior"
                     [src]="'assets/icon/faction-' + rootlogService.getFactionName(warCount.key) + '.png'" />

                <div>
                  x{{ warCount.value }}
                </div>
              </div>
            </div>
          </div>

          <div class="clearing-buildings" *ngIf="clearingHasBuildings(clearing)">
            <h3>Buildings</h3>

            <img class="clearing-component building"
                  *ngFor="let building of getBuildings(clearing)"
                  [src]="'assets/buildings/' + building + '.png'" />
          </div>

          <div class="clearing-tokens" *ngIf="clearingHasTokens(clearing)">
            <h3>Tokens</h3>

            <img class="clearing-component token"
                  *ngFor="let token of getTokens(clearing)"
                  [src]="'assets/tokens/' + token + '.png'" />
          </div>
        </div>
      </mat-card-content>
    </mat-card>
  </div>

  <div class="col">

    <div class="map-container">
      <div class="map" *ngIf="state">

        <img class="map-icon" [src]="'assets/map/map-' + game.map.toLowerCase() + '.png'" />

        <div class="map-clearing burrow"
             [ngClass]="[game.map.toLowerCase()]"
             *ngIf="game.players.D"
             (click)="showClearingInfo(0)"
             [class.selected]="currentClearing === 0">

          <img class="map-pin" [src]="'assets/clearing/clearing-burrow.png'" />

          <div class="map-components" *ngIf="state">
            <img class="map-component warrior"
                *ngFor="let warCount of state.clearings[0].warriors | keyvalue"
                [class.hidden]="!warCount.value"
                [src]="'assets/icon/faction-' + rootlogService.getFactionName(warCount.key) + '.png'" />
          </div>

        </div>

        <div class="map-clearing"
             [ngClass]="['clearing-' + (i + 1), 'clearing-' + suit]"
             *ngFor="let suit of game.clearings; let i = index"
             [class.selected]="currentClearing === i + 1"
             (click)="showClearingInfo(i + 1)"
             [style.left]="rootlogService.getClearingPositions(game.map)[i][0] + 'px'"
             [style.top]="rootlogService.getClearingPositions(game.map)[i][1] + 'px'">

          <img class="map-pin" [src]="'assets/clearing/clearing-' + rootlogService.getSuitName(suit) + '.png'" />

          <div class="map-components">
            <img class="map-component building"
                  *ngFor="let building of getBuildings(state.clearings[i + 1])"
                  [src]="'assets/buildings/' + building + '.png'" />

            <img class="map-component token"
                  *ngFor="let token of getTokens(state.clearings[i + 1])"
                  [src]="'assets/tokens/' + token + '.png'" />

            <img class="map-component warrior"
                *ngFor="let warCount of state.clearings[i + 1].warriors | keyvalue"
                [class.hidden]="!warCount.value"
                [src]="'assets/icon/faction-' + rootlogService.getFactionName(warCount.key) + '.png'" />
          </div>
        </div>

        <div class="map-clearing forest"
             [ngClass]="['forest-' + (forest.key || '')]"
             *ngFor="let forest of rootlogService.getForests(game.map) | keyvalue"
             [style.left]="forest.value[0] + 'px'"
             [style.top]="forest.value[1] + 'px'">

             <div class="map-components">
              <img class="map-component warrior"
                  *ngFor="let warCount of state.forests[forest.key].warriors | keyvalue"
                  [class.hidden]="!warCount.value"
                  [src]="'assets/icon/faction-' + rootlogService.getFactionName(warCount.key) + '.png'" />
             </div>
        </div>

      </div>
    </div>
  </div>

  <div class="col players-col">
    <mat-card>
      <mat-card-header>
        <mat-card-title>Player Scores</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <div class="players" *ngIf="state">
          <div class="player" *ngFor="let player of getPlayers(game)">
            <mat-icon class="player-turn" *ngIf="isActiveTurn(player.key)">play_arrow</mat-icon>
            <img class="player-icon" [src]="'assets/icon/faction-' + rootlogService.getFactionName(player.key) + '.png'" />
            <span class="player-name">{{ player.value }}</span>
            <span class="player-vp">[{{ getCurrentVP(player.key) }}]</span>
          </div>
        </div>
      </mat-card-content>
    </mat-card>
  </div>
</div>

<div class="row controls-row">

  <div class="controls">
    <button mat-icon-button
            [disabled]="currentAction === 0"
            (click)="prevTurn()"
            matTooltip="Previous Turn"
            color="accent">
      <mat-icon>arrow_back</mat-icon>
    </button>

    <button mat-icon-button
            [disabled]="currentAction === 0"
            (click)="setAction(currentAction - 1)"
            matTooltip="Previous Action"
            color="accent">
      <mat-icon>arrow_left</mat-icon>
    </button>

    <mat-slider color="accent"
                defaultColor="accent"
                min="0"
                [max]="allActions.length - 1"
                (change)="setAction($event.value || 0)"
                [(ngModel)]="currentAction"></mat-slider>

    <button mat-icon-button
            [disabled]="currentAction === allActions.length - 1"
            (click)="setAction(currentAction + 1)"
            matTooltip="Next Action"
            color="accent">
      <mat-icon>arrow_right</mat-icon>
    </button>

    <button mat-icon-button
            [disabled]="currentAction === allActions.length - 1"
            (click)="nextTurn()"
            matTooltip="Next Turn"
            color="accent">
      <mat-icon>arrow_forward</mat-icon>
    </button>

    <button mat-icon-button
            (click)="toggleAutoplay()"
            *ngIf="!autoPlay"
            matTooltip="Toggle Autoplay"
            color="accent">
      <mat-icon>double_arrow</mat-icon>
    </button>

    <button mat-mini-fab
            (click)="toggleAutoplay()"
            *ngIf="autoPlay"
            matTooltip="Toggle Autoplay"
            color="accent">
      <mat-icon>double_arrow</mat-icon>
    </button>

    <div class="current-action">
      <div>
        <span class="action-turn">({{ currentAction + 1 }}/{{ allActions.length }})</span>
        <span class="action-taker">[{{ rootlogService.getFactionProperName(action.currentTurn) }}]</span>
        <span class="action-desc">{{ action.description }}</span>
      </div>
    </div>
  </div>
</div>
